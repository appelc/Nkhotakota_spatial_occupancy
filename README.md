# Nkhotakota_spatial_occupancy

#### Code for spatial occupancy models with camera trap data from Nkhotakota Wildlife Reserve

All data needed to run these scripts are included in the `data/raw` folder. Note that intermediate objects are not included here for the sake of space but they can be generated by running the below scripts in order.

-   One exception: because the models take a long time to run, we have included an example model output file (`outputs/model01/model01_elephant.RDS`) that can be used to run step 02b and subsequent scripts.

Note that some of these scripts are best run on a high performance computing cluster (HPC) and can be called from the command line using arguments. For example:

`Rscript code/02a_run_model.R zebra 20000 outputs/model_run1`

The code has 3 main steps:

### 1. PREP:

*Prepare data for spOccupancy package*

-   `01a_prep_detections.R`: reads in long-format detection data, specifies primary and secondary sampling periods, and performs aggregation to create detection histories for spOccupancy stacked format

-   `01b_prep_covariates.R`: formats covariate data for multi-season spOccupancy

-   `01c_prep_inputs.R`: takes detection histories, covariate data, and spatial coordinates to create input objects (RDS files) for spOccupancy

### 2. RUN

*Run and evaluate the spatial occupancy model(s). (Highly recommended to use HPC if possible.)*

-   `02a_run_model.R`: runs the spatial occupancy model reported in the paper (single species spatiotemporal model with *stPGOcc*)

-   `02b_run_diagnostics.R`: generates trace plots and summary files for model diagnostics (coefficient estimates, Rhat, ESS)

-   `02c_run_ppc.R`: runs posterior predictive checks and calculates Bayesian p-values

### 3. REPORT

*Compute derived parameters, create plots, conduct post-hoc trend analysis*

-   `03a_prediction.R`: takes model outputs, new covariate values, and spatial coordinates to generate predictions at new sites. *(Recommended to use HPC if possible.)*

-   `03b_prediction_maps.R`: reads in prediction data for all species to create distribution maps (FIG 4)

-   `03c_derive_parameters.R`: left off cleaning up here. I copied and pasted the rest I think I'll need into the code folder (except extras like "checking", study area map, etc...)

-   `03d_marginal_plots.R`

-   `03e_trend_analysis.R`: what's the difference between these diff versions?

-   `03f_spatial_correlation.R`
